from typing import Optional
from pydantic import BaseModel, Field


class SMARTResult(BaseModel):
    """
    Модель для захвата аспектов SMART-цели для этапа проекта.
    Поля specific, measurable, achievable, relevant, time_bound служат чек-листом для внутренней проверки,
    а field result_description – итоговая компиляция этих полей.
    Все числовые данные (например, проценты, даты, количественные показатели) должны извлекаться только из исходного текста.
    Если числовые данные отсутствуют, используйте значение 'Не указано'.
    """

    specific: Optional[str] = Field(
        "Не указано",
        description="Конкретное описание результата с ссылкой на исходный текст. Не генерируйте числа, если их нет в тексте.",
        examples=[
            "Не указано",
            "Повысить оперативность реагирования на обращения граждан. Цитата: 'Оперативность повысилась на 20% после оптимизации процессов.'",
        ],
    )
    measurable: Optional[str] = Field(
        "Не указано",
        description="Критерии для измерения успеха, включая точные числовые показатели из исходного текста. Если число не указано — 'Не указано'.",
        examples=[
            "Не указано",
            "Увеличение количества обращений на 20%. Цитата: 'Обращений увеличилось на 20% после внедрения новой системы.'",
        ],
    )
    achievable: Optional[str] = Field(
        "Не указано",
        description="Обоснование достижимости результата с привязкой к исходному тексту, без генерации дополнительных числовых данных.",
        examples=[
            "Не указано",
            "Использование современных технологий. Цитата: 'Благодаря современным технологиям, выполнение задачи возможно.'",
        ],
    )
    relevant: Optional[str] = Field(
        "Не указано",
        description="Описание соответствия результатов целям проекта. Используйте только данные, присутствующие в исходном описании.",
        examples=[
            "Не указано",
            "Соответствует целям повышения эффективности. Цитата: 'Эффективность возросла, что соответствует стратегическим целям.'",
        ],
    )
    time_bound: Optional[str] = Field(
        "Не указано",
        description="Временные рамки достижения результата, строго извлеченные из исходного текста (например, дата или период).",
        examples=[
            "Не указано",
            "До 31 марта 2025 года. Цитата: 'Проект должен быть завершён до 31 марта 2025 года.'",
        ],
    )
    result_description: str = Field(
        ...,
        description="Компиляция полей specific, measurable, achievable, relevant, time_bound в единый абзац, составленная только из данных исходного текста и указанных полей.",
        example="Повысили оперативность реагирования на обращения граждан на 20% к 31 марта 2025 года.",
    )


class ProjectStage(BaseModel):
    """
    Модель для каждого этапа проекта, включая результаты, прописанные по методологии SMART.
    """

    stage_name: str = Field(
        ...,
        description="Название этапа",
        examples=[
            "Сбор данных у граждан",
            "Анализ и выявление острых проблем",
            "Реализация пилотного проекта",
            "Тестирование в малых регионах",
        ],
    )
    stage_start_date: str = Field(
        ...,
        description="Дата начала этапа (формат YYYY-MM-DD)",
        example="2023-01-01",
    )
    stage_end_date: str = Field(
        description="Дата окончания этапа (формат YYYY-MM-DD)",
        example="2023-12-31",
    )
    smart_results: list[SMARTResult] = Field(
        ...,
        description="Результаты этапа, прописанные по методологии SMART",
    )


class ProjectTeam(BaseModel):
    """
    Model for the project team roles and members.
    """

    project_initiator: Optional[str] = Field(
        "Не указано",
        description="Инициатор проекта: Принимает решение о необходимости реализации проекта, определяет высокоуровневые требования и назначает владельца проекта.",
        example="Д.Н. Иванов",
    )
    project_owner: Optional[str] = Field(
        "Не указано",
        description="Владелец проекта: Даёт поручения о запуске проекта, утверждает паспорт проекта, назначает руководителя проекта и куратора команды управления.",
        example="Д.Н. Иванов",
    )
    project_management_committee: Optional[list[str]] = Field(
        [],
        description="Управляющий комитет проекта: Согласовывает паспорт проекта и изменения, определяет цели и контролирует реализацию этапов.",
        example=["Д.Н. Иванов", "А.С. Петров"],
    )
    project_owner_representative: Optional[str] = Field(
        "Не указано",
        description="Представитель Владельца проекта: Обеспечивает проведение совещаний и коммуникацию между сторонами.",
        example="Д.Н. Иванов",
    )
    project_leader: Optional[str] = Field(
        "Не указано",
        description="Руководитель проекта (РП): Формирует паспорт проекта, управляет командой и обеспечивает эскалацию рисков.",
        example="Д.Н. Иванов",
    )
    management_team_curator: Optional[str] = Field(
        "Не указано",
        description="Куратор команды управления: Предоставляет информацию об оценке необходимых ресурсов и формирует предложения по команде.",
        example="Д.Н. Иванов",
    )
    project_manager: Optional[str] = Field(
        "Не указано",
        description="Менеджер проекта (МП): Координирует реализацию плана проекта, отвечает за организацию мероприятий и ведение отчетности.",
        example="Д.Н. Иванов",
    )
    strategy_portfolio_leader: Optional[str] = Field(
        "Не указано",
        description="Руководитель портфеля мероприятий Стратегии: Формирует сводную оценку и согласовывает цели и планы мероприятий.",
        example="Д.Н. Иванов",
    )
    strategy_event_leader: Optional[str] = Field(
        "Не указано",
        description="Руководитель мероприятия Стратегии: Формирует детализированный план реализации мероприятия и управляет его выполнением.",
        example="Д.Н. Иванов",
    )
    independent_experts: Optional[list[str]] = Field(
        [],
        description="Независимые эксперты проекта: Оценивают эффективность реализации мероприятий и проводят аудит проекта.",
        example=["Д.Н. Иванов", "А.С. Петров"],
    )


class ProjectData(BaseModel):
    """
    Модель для всех полей, связанных с описанием проекта.
    """

    project_name: str = Field(
        ..., description="Наименование проекта", example="Обработка обращений граждан"
    )
    project_start_order_form: str = Field(
        ...,
        description="Поручение о старте проекта (форма поручения, устное/письменное поручение)",
        example="Письменное поручение",
    )
    project_stakeholders: list[str] = Field(
        ...,
        description="Список заинтересованных сторон: основные группы и/или физические лица, которые имеют интересы в реализации проекта или могут на него влиять.",
        example=[
            "Министерство здравоохранения Российской Федерации",
            "Федеральная служба по надзору в сфере энергетики",
        ],
    )
    project_steering_committee: list[str] = Field(
        ...,
        description="Состав Управляющего комитета проекта: список членов комитета, ответственных за стратегический контроль и ключевые решения по проекту.",
        example=["Шубин", "Ицхаков", "Белова"],
    )
    project_team: ProjectTeam = Field(..., description="Команда проекта")
    project_start_date: str = Field(
        description="Дата начала проекта (формат YYYY-MM-DD)",
        example="2023-01-01",
    )
    # project_stages are placed above project_goal, project_result_vision, project_constraints_exclusions and project_risks_assumptions
    # this simulate CoT and force model to reason more.
    project_stages: list[ProjectStage] = Field(
        ..., description="Список этапов и результатов проекта"
    )
    project_goal: str = Field(
        ...,
        description="Цель проекта: краткое описание ключевых задач и результатов, которых проект стремится достичь.",
        example="Повысить оперативность реагирования на обращения граждан.",
    )
    project_result_vision: str = Field(
        ...,
        description="Образ результата проекта: описание итогового результата и его характеристик, демонстрирующих успех проекта.",
        example="Интерактивная платформа с быстрым доступом к аналитическим данным.",
    )
    project_constraints_exclusions: list[str] = Field(
        ...,
        description="Ограничения и исключения проекта: список ограничений, рамок и аспектов, которые вне сферы проекта, влияющих на его реализацию.",
        example=["Финансовые ограничения", "Ограниченный кадровый состав"],
    )
    project_risks_assumptions: list[str] = Field(
        ...,
        description="Риски и допущения проекта: перечень потенциальных угроз и предположений, на которых базируется план реализации проекта.",
        example=["Риск задержки поставок", "Предположение о стабильности рынка"],
    )
